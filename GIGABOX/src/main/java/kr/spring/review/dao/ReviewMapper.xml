<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.spring.review.dao.ReviewMapper">
	<!-- 관람평 쓰기 -->
	<insert id="insertReview" parameterType="reviewVO">
		INSERT INTO review(
			review_num,
			movie_num,
			mem_num,
			rating_score,
			review_content)
		VALUES(
			review_seq.nextval,
			#{movie_num},
			#{mem_num},
			#{rating_score},
			#{review_content})
	</insert>
	<!-- 관람평 목록 --> <!-- 임시로 다 작성할 수 있게 구현! 후에 예매 한 것만 작성할 수 있도록 구현하기 -->
	<select id="selectListReview" parameterType="map" resultType="reviewVO">
	SELECT * FROM
	(SELECT a.*, rownum rnum FROM
	(SELECT review_num,
	<![CDATA[
	REPLACE(REPLACE(review_content,'<','&lt;'),'>','&gt;') review_content,
	]]>
	review_date,review_mdate,movie_num,mem_num,id,nick_name FROM review JOIN member USING(mem_num) WHERE movie_num = #{movie_num}
	ORDER BY review_date DESC)a)
	<![CDATA[ WHERE rnum >= #{start} AND rnum <= #{end}]]>
	</select>
</mapper>